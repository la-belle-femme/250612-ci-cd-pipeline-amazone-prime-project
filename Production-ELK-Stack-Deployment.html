<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ELK Stack Production Deployment - Interactive Guide</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .dashboard-container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            margin-top: 20px;
            margin-bottom: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .progress-bar {
            background: rgba(255,255,255,0.2);
            height: 10px;
            border-radius: 5px;
            margin-top: 20px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #28a745, #20c997);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 5px;
        }

        .navigation {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 2px solid #dee2e6;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 12px 20px;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            user-select: none;
        }

        .nav-tab:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
        }

        .nav-tab.completed {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border-color: #28a745;
        }

        .content {
            padding: 30px;
        }

        .phase {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .phase.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .phase-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .phase-title {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .phase-description {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .step {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #667eea;
            transition: all 0.3s ease;
        }

        .step:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.15);
        }

        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            cursor: pointer;
            user-select: none;
        }

        .step-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #667eea;
            border-radius: 4px;
            margin-right: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .step-checkbox.completed {
            background: #28a745;
            border-color: #28a745;
        }

        .step-checkbox.completed::after {
            content: '✓';
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        .step-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2c3e50;
            flex-grow: 1;
        }

        .step-content {
            margin-left: 35px;
        }

        .command-block {
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            position: relative;
            overflow-x: auto;
            border: 1px solid #333;
        }

        .command-block::before {
            content: '$ ';
            color: #ffd700;
            font-weight: bold;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            background: #5a67d8;
            transform: scale(1.05);
        }

        .copy-btn.copied {
            background: #28a745;
        }

        .warning-box {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border: 1px solid #ffc107;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 5px solid #ffc107;
        }

        .warning-box::before {
            content: '⚠️ ';
            font-size: 1.2rem;
        }

        .info-box {
            background: linear-gradient(135deg, #d1ecf1, #b3e5fc);
            border: 1px solid #17a2b8;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 5px solid #17a2b8;
        }

        .info-box::before {
            content: 'ℹ️ ';
            font-size: 1.2rem;
        }

        .success-box {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            border: 1px solid #28a745;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 5px solid #28a745;
        }

        .success-box::before {
            content: '✅ ';
            font-size: 1.2rem;
        }

        .mermaid-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .resource-monitor {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px solid #dee2e6;
        }

        .monitor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .monitor-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .monitor-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .monitor-label {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding: 20px 0;
        }

        .nav-button {
            padding: 12px 25px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .nav-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .collapsible-content.expanded {
            max-height: 2000px;
        }

        .expand-icon {
            margin-left: 10px;
            transition: transform 0.3s ease;
        }

        .expand-icon.rotated {
            transform: rotate(180deg);
        }

        @media (max-width: 768px) {
            .dashboard-container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .content {
                padding: 20px;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .nav-tab {
                text-align: center;
            }
        }

        .architecture-overview {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            border: 2px solid #dee2e6;
        }

        .requirements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .requirement-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #667eea;
        }

        .requirement-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .troubleshooting {
            background: #fff5f5;
            border: 2px solid #feb2b2;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .troubleshooting h4 {
            color: #c53030;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="header">
            <h1>🚀 Production ELK Stack Deployment</h1>
            <p><strong>Ticket #269</strong> - Challenge-Free Interactive Guide</p>
            <p>EKS Cluster: <strong>amazon-prime-eks</strong> | Region: <strong>us-east-1</strong></p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <div class="navigation">
            <div class="nav-tabs">
                <div class="nav-tab active" data-phase="overview">📋 Overview</div>
                <div class="nav-tab" data-phase="phase1">🔧 Phase 1: Prep</div>
                <div class="nav-tab" data-phase="phase2">🏗️ Phase 2: Infrastructure</div>
                <div class="nav-tab" data-phase="phase3">📊 Phase 3: OpenSearch</div>
                <div class="nav-tab" data-phase="phase4">🌐 Phase 4: Load Balancer</div>
                <div class="nav-tab" data-phase="phase5">📈 Phase 5: Monitoring</div>
                <div class="nav-tab" data-phase="phase6">🔄 Phase 6: Jenkins</div>
            </div>
        </div>

        <div class="content">
            <!-- Overview Phase -->
            <div class="phase active" id="overview">
                <div class="phase-header">
                    <div class="phase-title">📋 Deployment Overview</div>
                    <div class="phase-description">Complete architecture and strategy overview</div>
                </div>

                <div class="architecture-overview">
                    <h3>🏗️ Architecture Diagram</h3>
                    <div class="mermaid-container">
                        <div class="mermaid">
                            graph TB
                                subgraph "AWS EKS Cluster (amazon-prime-eks)"
                                    subgraph "elk-stack namespace"
                                        OS[OpenSearch<br/>Single Node]
                                        OSD[OpenSearch Dashboards<br/>Web Interface]
                                        OS --> OSD
                                    end
                                    
                                    subgraph "monitoring namespace"
                                        PROM[Prometheus<br/>Metrics Collection]
                                        GRAF[Grafana<br/>Dashboards]
                                        PROM --> GRAF
                                    end
                                    
                                    subgraph "kube-system namespace"
                                        ALB[AWS Load Balancer<br/>Controller]
                                        CERT[cert-manager<br/>SSL Certificates]
                                    end
                                end
                                
                                subgraph "Access Methods"
                                    PF[Port Forward<br/>kubectl port-forward]
                                    NP[NodePort Service<br/>Direct Access]
                                end
                                
                                USER[👤 Users] --> PF
                                USER --> NP
                                PF --> OSD
                                NP --> OSD
                                
                                subgraph "CI/CD"
                                    JENKINS[Jenkins Server<br/>t3.medium]
                                    GIT[GitHub Repository<br/>Source Code]
                                    GIT --> JENKINS
                                    JENKINS --> OS
                                end
                                
                                style OS fill:#e1f5fe
                                style OSD fill:#f3e5f5
                                style PROM fill:#fff3e0
                                style GRAF fill:#e8f5e8
                                style ALB fill:#fff8e1
                                style CERT fill:#fce4ec
                        </div>
                    </div>
                </div>

                <div class="requirements-grid">
                    <div class="requirement-card">
                        <div class="requirement-title">🎯 Deployment Strategy</div>
                        <ul>
                            <li>✅ OpenSearch instead of Elasticsearch (avoids config conflicts)</li>
                            <li>✅ Port-forwarding for access (no domain needed)</li>
                            <li>✅ Single-node setup (perfect for 10 users)</li>
                            <li>✅ Pre-validated configurations</li>
                        </ul>
                    </div>
                    
                    <div class="requirement-card">
                        <div class="requirement-title">🛠️ Tools We'll Use</div>
                        <ul>
                            <li>📦 Helm for package management</li>
                            <li>🔧 kubectl for cluster management</li>
                            <li>🌐 AWS CLI for AWS resources</li>
                            <li>📊 OpenSearch + Dashboards</li>
                        </ul>
                    </div>
                    
                    <div class="requirement-card">
                        <div class="requirement-title">⏱️ Time Estimates</div>
                        <ul>
                            <li>Phase 1: 15 minutes</li>
                            <li>Phase 2: 20 minutes</li>
                            <li>Phase 3: 25 minutes</li>
                            <li>Phase 4: 20 minutes</li>
                            <li>Phase 5: 15 minutes</li>
                            <li>Phase 6: 20 minutes</li>
                        </ul>
                    </div>
                    
                    <div class="requirement-card">
                        <div class="requirement-title">🎯 Expected Results</div>
                        <ul>
                            <li>✅ Working OpenSearch cluster</li>
                            <li>✅ Accessible OpenSearch Dashboards</li>
                            <li>✅ Prometheus monitoring</li>
                            <li>✅ Jenkins automation pipeline</li>
                        </ul>
                    </div>
                </div>

                <div class="info-box">
                    <strong>Why This Approach Avoids Previous Challenges:</strong><br>
                    • Using OpenSearch from start (no Elasticsearch conflicts)<br>
                    • Port-forward access (no ALB permission issues)<br>
                    • Pre-tested configurations (no trial-and-error)<br>
                    • Clear naming conventions (no service discovery issues)
                </div>
            </div>

            <!-- Phase 1: Environment Preparation -->
            <div class="phase" id="phase1">
                <div class="phase-header">
                    <div class="phase-title">🔧 Phase 1: Environment Preparation</div>
                    <div class="phase-description">Validate cluster health and install required tools</div>
                </div>

                <div class="step">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-checkbox" onclick="toggleCheckbox(event, this)"></div>
                        <div class="step-title">Step 1.1: Verify EKS Cluster Access</div>
                        <span class="expand-icon">▼</span>
                    </div>
                    <div class="step-content collapsible-content">
                        <p>First, let's ensure we can connect to your EKS cluster properly.</p>
                        
                        <div class="command-block">
aws eks update-kubeconfig --region us-east-1 --name amazon-prime-eks
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
kubectl get nodes -o wide
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="success-box">
                            <strong>Expected Output:</strong> You should see 2 t3.medium nodes in Ready status
                        </div>
                        
                        <div class="command-block">
kubectl get namespaces
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                    </div>
                </div>

                <div class="step">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-checkbox" onclick="toggleCheckbox(event, this)"></div>
                        <div class="step-title">Step 1.2: Install Helm (if not already installed)</div>
                        <span class="expand-icon">▼</span>
                    </div>
                    <div class="step-content collapsible-content">
                        <p>Check if Helm is installed, if not, we'll install it.</p>
                        
                        <div class="command-block">
helm version
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="warning-box">
                            <strong>If Helm is not installed, run these commands:</strong>
                        </div>
                        
                        <div class="command-block">
curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="info-box">
                            <strong>Alternative for Windows:</strong> Download from <a href="https://github.com/helm/helm/releases" target="_blank">https://github.com/helm/helm/releases</a>
                        </div>
                    </div>
                </div>

                <div class="step">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-checkbox" onclick="toggleCheckbox(event, this)"></div>
                        <div class="step-title">Step 1.3: Create Namespaces</div>
                        <span class="expand-icon">▼</span>
                    </div>
                    <div class="step-content collapsible-content">
                        <p>Create organized namespaces for our deployment.</p>
                        
                        <div class="command-block">
kubectl create namespace elk-stack
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
kubectl create namespace monitoring
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
kubectl get namespaces | grep -E "(elk-stack|monitoring)"
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="success-box">
                            <strong>Expected Output:</strong> Both namespaces should be listed as Active
                        </div>
                    </div>
                </div>

                <div class="step">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-checkbox" onclick="toggleCheckbox(event, this)"></div>
                        <div class="step-title">Step 1.4: Add Required Helm Repositories</div>
                        <span class="expand-icon">▼</span>
                    </div>
                    <div class="step-content collapsible-content">
                        <p>Add all the Helm repositories we'll need for our deployment.</p>
                        
                        <div class="command-block">
helm repo add opensearch https://opensearch-project.github.io/helm-charts/
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
helm repo add eks https://aws.github.io/eks-charts
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
helm repo add jetstack https://charts.jetstack.io
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
helm repo update
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
helm repo list
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                    </div>
                </div>

                <div class="resource-monitor">
                    <h4>📊 Phase 1 Validation</h4>
                    <div class="monitor-grid">
                        <div class="monitor-card">
                            <div class="monitor-value">2</div>
                            <div class="monitor-label">EKS Nodes</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-value">2</div>
                            <div class="monitor-label">New Namespaces</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-value">4</div>
                            <div class="monitor-label">Helm Repos</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-value">✅</div>
                            <div class="monitor-label">Kubectl Access</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Phase 2: Infrastructure Prerequisites -->
            <div class="phase" id="phase2">
                <div class="phase-header">
                    <div class="phase-title">🏗️ Phase 2: Infrastructure Prerequisites</div>
                    <div class="phase-description">Install AWS Load Balancer Controller and cert-manager</div>
                </div>

                <div class="step">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-checkbox" onclick="toggleCheckbox(event, this)"></div>
                        <div class="step-title">Step 2.1: Install AWS Load Balancer Controller</div>
                        <span class="expand-icon">▼</span>
                    </div>
                    <div class="step-content collapsible-content">
                        <p>Install the AWS Load Balancer Controller for ALB integration.</p>
                        
                        <div class="info-box">
                            <strong>Note:</strong> This approach uses the existing EKS OIDC provider, avoiding eksctl issues
                        </div>
                        
                        <div class="command-block">
curl -o iam_policy.json https://raw.githubusercontent.com/kubernetes-sigs/aws-load-balancer-controller/v2.7.2/docs/install/iam_policy.json
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
aws iam create-policy --policy-name AWSLoadBalancerControllerIAMPolicy --policy-document file://iam_policy.json
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="warning-box">
                            <strong>If policy already exists:</strong> You'll get an error, which is fine - the policy is already there
                        </div>
                        
                        <div class="command-block">
eksctl utils associate-iam-oidc-provider --region=us-east-1 --cluster=amazon-prime-eks --approve
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
eksctl create iamserviceaccount --cluster=amazon-prime-eks --namespace=kube-system --name=aws-load-balancer-controller --role-name AmazonEKSLoadBalancerControllerRole --attach-policy-arn=arn:aws:iam::$(aws sts get-caller-identity --query Account --output text):policy/AWSLoadBalancerControllerIAMPolicy --approve --region=us-east-1
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
helm install aws-load-balancer-controller eks/aws-load-balancer-controller -n kube-system --set clusterName=amazon-prime-eks --set serviceAccount.create=false --set serviceAccount.name=aws-load-balancer-controller
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
kubectl get deployment -n kube-system aws-load-balancer-controller
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                    </div>
                </div>

                <div class="step">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-checkbox" onclick="toggleCheckbox(event, this)"></div>
                        <div class="step-title">Step 2.2: Install cert-manager</div>
                        <span class="expand-icon">▼</span>
                    </div>
                    <div class="step-content collapsible-content">
                        <p>Install cert-manager for automatic SSL certificate management.</p>
                        
                        <div class="command-block">
kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.13.2/cert-manager.crds.yaml
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
helm install cert-manager jetstack/cert-manager --namespace cert-manager --create-namespace --version v1.13.2
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
kubectl get pods --namespace cert-manager
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="success-box">
                            <strong>Expected Output:</strong> All cert-manager pods should be Running
                        </div>
                    </div>
                </div>

                <div class="step">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-checkbox" onclick="toggleCheckbox(event, this)"></div>
                        <div class="step-title">Step 2.3: Verify Infrastructure Components</div>
                        <span class="expand-icon">▼</span>
                    </div>
                    <div class="step-content collapsible-content">
                        <p>Verify all infrastructure components are running correctly.</p>
                        
                        <div class="command-block">
kubectl get pods -n kube-system | grep aws-load-balancer-controller
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
kubectl get pods -n cert-manager
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
kubectl get crd | grep cert-manager
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="success-box">
                            <strong>All components should be running and ready!</strong>
                        </div>
                    </div>
                </div>

                <div class="resource-monitor">
                    <h4>📊 Phase 2 Status</h4>
                    <div class="monitor-grid">
                        <div class="monitor-card">
                            <div class="monitor-value">✅</div>
                            <div class="monitor-label">ALB Controller</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-value">✅</div>
                            <div class="monitor-label">cert-manager</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-value">2</div>
                            <div class="monitor-label">Infrastructure Services</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-value">Ready</div>
                            <div class="monitor-label">For OpenSearch</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Phase 3: OpenSearch Deployment -->
            <div class="phase" id="phase3">
                <div class="phase-header">
                    <div class="phase-title">📊 Phase 3: OpenSearch Stack Deployment</div>
                    <div class="phase-description">Deploy OpenSearch and OpenSearch Dashboards with proven configurations</div>
                </div>

                <div class="step">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-checkbox" onclick="toggleCheckbox(event, this)"></div>
                        <div class="step-title">Step 3.1: Create OpenSearch Configuration</div>
                        <span class="expand-icon">▼</span>
                    </div>
                    <div class="step-content collapsible-content">
                        <p>Create a configuration file for OpenSearch that avoids all previous issues.</p>
                        
                        <div class="info-box">
                            <strong>This config avoids:</strong> Security conflicts, SSL issues, and single-node problems
                        </div>
                        
                        <div class="command-block">
cat > opensearch-values.yaml << 'EOF'
clusterName: "amazon-prime-opensearch"
nodeGroup: "master"

masterService: "amazon-prime-opensearch"
replicas: 1

# Java opts
opensearchJavaOpts: "-Xmx1g -Xms1g"

# Cluster configuration
opensearchConfiguration:
  opensearch.yml: |
    cluster.name: amazon-prime-opensearch
    network.host: 0.0.0.0
    plugins.security.disabled: true
    discovery.type: single-node

# Security disabled to avoid authentication issues
securityConfig:
  enabled: false

# Resources
resources:
  requests:
    cpu: "500m"
    memory: "1Gi"
  limits:
    cpu: "1000m"
    memory: "2Gi"

# Persistence
persistence:
  enabled: true
  size: 10Gi

# Service
service:
  type: ClusterIP
  httpPortName: http
  transportPortName: transport

# Node selector for t3.medium nodes
nodeSelector: {}
tolerations: []
affinity: {}
EOF
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                    </div>
                </div>

                <div class="step">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-checkbox" onclick="toggleCheckbox(event, this)"></div>
                        <div class="step-title">Step 3.2: Deploy OpenSearch</div>
                        <span class="expand-icon">▼</span>
                    </div>
                    <div class="step-content collapsible-content">
                        <p>Deploy OpenSearch using our tested configuration.</p>
                        
                        <div class="command-block">
helm install amazon-prime-opensearch opensearch/opensearch -f opensearch-values.yaml -n elk-stack
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
kubectl get pods -n elk-stack -w
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="warning-box">
                            <strong>Wait time:</strong> OpenSearch can take 3-5 minutes to start. Watch for Running status.
                        </div>
                        
                        <div class="command-block">
kubectl logs -n elk-stack -l app=opensearch,role=master --tail=50
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="success-box">
                            <strong>Look for:</strong> "started" and "Node started" messages in logs
                        </div>
                    </div>
                </div>

                <div class="step">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-checkbox" onclick="toggleCheckbox(event, this)"></div>
                        <div class="step-title">Step 3.3: Create OpenSearch Dashboards Configuration</div>
                        <span class="expand-icon">▼</span>
                    </div>
                    <div class="step-content collapsible-content">
                        <p>Create configuration for OpenSearch Dashboards that properly connects to OpenSearch.</p>
                        
                        <div class="command-block">
cat > opensearch-dashboards-values.yaml << 'EOF'
opensearchHosts: "http://amazon-prime-opensearch-master:9200"

replicaCount: 1

# Security disabled to match OpenSearch
securityConfig:
  enabled: false

# OpenSearch Dashboards configuration
opensearchDashboardsYml:
  opensearch_dashboards.yml: |
    server.host: 0.0.0.0
    opensearch.hosts: ["http://amazon-prime-opensearch-master:9200"]
    opensearch.ssl.verificationMode: none
    opensearch.requestHeadersWhitelist: [ authorization,securitytenant ]

# Resources
resources:
  requests:
    cpu: "250m"
    memory: "512Mi"
  limits:
    cpu: "500m"
    memory: "1Gi"

# Service
service:
  type: ClusterIP
  port: 5601
  targetPort: 5601
  protocol: TCP

# No ingress yet - we'll access via port-forward
ingress:
  enabled: false
EOF
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                    </div>
                </div>

                <div class="step">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-checkbox" onclick="toggleCheckbox(event, this)"></div>
                        <div class="step-title">Step 3.4: Deploy OpenSearch Dashboards</div>
                        <span class="expand-icon">▼</span>
                    </div>
                    <div class="step-content collapsible-content">
                        <p>Deploy OpenSearch Dashboards with the correct configuration.</p>
                        
                        <div class="command-block">
helm install amazon-prime-dashboards opensearch/opensearch-dashboards -f opensearch-dashboards-values.yaml -n elk-stack
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
kubectl get pods -n elk-stack
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
kubectl logs -n elk-stack -l app=opensearch-dashboards --tail=50
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="success-box">
                            <strong>Look for:</strong> "Server running at http://0.0.0.0:5601" in the logs
                        </div>
                    </div>
                </div>

                <div class="step">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-checkbox" onclick="toggleCheckbox(event, this)"></div>
                        <div class="step-title">Step 3.5: Test OpenSearch Connection</div>
                        <span class="expand-icon">▼</span>
                    </div>
                    <div class="step-content collapsible-content">
                        <p>Verify that OpenSearch is working and accessible.</p>
                        
                        <div class="command-block">
kubectl get services -n elk-stack
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
kubectl port-forward -n elk-stack svc/amazon-prime-opensearch-master 9200:9200 &
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
curl http://localhost:9200
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="success-box">
                            <strong>Expected:</strong> JSON response with cluster information
                        </div>
                        
                        <div class="command-block">
curl http://localhost:9200/_cluster/health
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="info-box">
                            <strong>Stop port-forward:</strong> Press Ctrl+C or run: <code>pkill -f "port-forward.*9200"</code>
                        </div>
                    </div>
                </div>

                <div class="step">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-checkbox" onclick="toggleCheckbox(event, this)"></div>
                        <div class="step-title">Step 3.6: Access OpenSearch Dashboards</div>
                        <span class="expand-icon">▼</span>
                    </div>
                    <div class="step-content collapsible-content">
                        <p>Access OpenSearch Dashboards via port-forwarding.</p>
                        
                        <div class="command-block">
kubectl port-forward -n elk-stack svc/amazon-prime-dashboards-opensearch-dashboards 5601:5601
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="info-box">
                            <strong>Access URL:</strong> Open your browser and go to <a href="http://localhost:5601" target="_blank">http://localhost:5601</a>
                        </div>
                        
                        <div class="success-box">
                            <strong>Success!</strong> You should see the OpenSearch Dashboards welcome screen. No authentication required!
                        </div>
                        
                        <div class="warning-box">
                            <strong>Keep this terminal open</strong> while you explore the dashboards. Press Ctrl+C when done.
                        </div>
                    </div>
                </div>

                <div class="resource-monitor">
                    <h4>📊 Phase 3 Status</h4>
                    <div class="monitor-grid">
                        <div class="monitor-card">
                            <div class="monitor-value">✅</div>
                            <div class="monitor-label">OpenSearch</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-value">✅</div>
                            <div class="monitor-label">Dashboards</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-value">5601</div>
                            <div class="monitor-label">Access Port</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-value">No Auth</div>
                            <div class="monitor-label">Easy Access</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Phase 4: Load Balancer Setup -->
            <div class="phase" id="phase4">
                <div class="phase-header">
                    <div class="phase-title">🌐 Phase 4: Load Balancer & External Access</div>
                    <div class="phase-description">Configure ALB Ingress and external access options</div>
                </div>

                <div class="step">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-checkbox" onclick="toggleCheckbox(event, this)"></div>
                        <div class="step-title">Step 4.1: Create Ingress Configuration</div>
                        <span class="expand-icon">▼</span>
                    </div>
                    <div class="step-content collapsible-content">
                        <p>Create an ALB Ingress for external access (optional for production use).</p>
                        
                        <div class="warning-box">
                            <strong>Note:</strong> Since you don't have a domain, we'll create the ingress for future use but continue using port-forward for now.
                        </div>
                        
                        <div class="command-block">
cat > opensearch-ingress.yaml << 'EOF'
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  namespace: elk-stack
  name: opensearch-dashboards-ingress
  annotations:
    kubernetes.io/ingress.class: alb
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS":443}]'
    alb.ingress.kubernetes.io/ssl-redirect: '443'
    alb.ingress.kubernetes.io/healthcheck-path: /
    alb.ingress.kubernetes.io/healthcheck-protocol: HTTP
    alb.ingress.kubernetes.io/healthcheck-port: traffic-port
spec:
  rules:
  - host: opensearch.example.com  # Replace with your domain when available
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: amazon-prime-dashboards-opensearch-dashboards
            port:
              number: 5601
EOF
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="info-box">
                            <strong>Future Use:</strong> When you have a domain, replace "opensearch.example.com" with your actual domain.
                        </div>
                    </div>
                </div>

                <div class="step">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-checkbox" onclick="toggleCheckbox(event, this)"></div>
                        <div class="step-title">Step 4.2: Create NodePort Service (Alternative Access)</div>
                        <span class="expand-icon">▼</span>
                    </div>
                    <div class="step-content collapsible-content">
                        <p>Create a NodePort service for direct access to OpenSearch Dashboards.</p>
                        
                        <div class="command-block">
cat > nodeport-service.yaml << 'EOF'
apiVersion: v1
kind: Service
metadata:
  name: opensearch-dashboards-nodeport
  namespace: elk-stack
  labels:
    app: opensearch-dashboards
spec:
  type: NodePort
  ports:
  - port: 5601
    targetPort: 5601
    nodePort: 30001
    protocol: TCP
    name: http
  selector:
    app: opensearch-dashboards
EOF
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
kubectl apply -f nodeport-service.yaml
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
kubectl get services -n elk-stack
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="info-box">
                            <strong>NodePort Access:</strong> Your service is now available on port 30001 of any node (when nodes have public IPs)
                        </div>
                    </div>
                </div>

                <div class="step">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-checkbox" onclick="toggleCheckbox(event, this)"></div>
                        <div class="step-title">Step 4.3: Test Multiple Access Methods</div>
                        <span class="expand-icon">▼</span>
                    </div>
                    <div class="step-content collapsible-content">
                        <p>Test different ways to access your OpenSearch Dashboards.</p>
                        
                        <div class="command-block">
kubectl get nodes -o wide
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="info-box">
                            <strong>Method 1 - Port Forward (Recommended):</strong>
                        </div>
                        
                        <div class="command-block">
kubectl port-forward -n elk-stack svc/amazon-prime-dashboards-opensearch-dashboards 8087:5601
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="success-box">
                            <strong>Access:</strong> <a href="http://localhost:8087" target="_blank">http://localhost:8087</a>
                        </div>
                        
                        <div class="warning-box">
                            <strong>If port 8087 is busy, try 8088, 8089, etc.</strong>
                        </div>
                        
                        <div class="info-box">
                            <strong>Method 2 - NodePort (if nodes have public IPs):</strong>
                        </div>
                        
                        <div class="command-block">
# Get node external IP (if available)
kubectl get nodes -o jsonpath='{.items[0].status.addresses[?(@.type=="ExternalIP")].address}'
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="warning-box">
                            <strong>Note:</strong> Your nodes appear to be in private subnets, so port-forward is the preferred method.
                        </div>
                    </div>
                </div>

                <div class="step">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-checkbox" onclick="toggleCheckbox(event, this)"></div>
                        <div class="step-title">Step 4.4: Configure Sample Data</div>
                        <span class="expand-icon">▼</span>
                    </div>
                    <div class="step-content collapsible-content">
                        <p>Add some sample data to make your dashboards more interesting.</p>
                        
                        <div class="info-box">
                            <strong>Using OpenSearch Dashboards:</strong> Go to the Dev Tools section and run these commands:
                        </div>
                        
                        <div class="command-block">
# Create a sample index
PUT /sample-logs-2024.06.22
{
  "mappings": {
    "properties": {
      "timestamp": {"type": "date"},
      "message": {"type": "text"},
      "level": {"type": "keyword"},
      "service": {"type": "keyword"}
    }
  }
}
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
# Add sample documents
POST /sample-logs-2024.06.22/_doc
{
  "timestamp": "2024-06-22T10:00:00Z",
  "message": "Application started successfully",
  "level": "INFO",
  "service": "amazon-prime-api"
}
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
POST /sample-logs-2024.06.22/_doc
{
  "timestamp": "2024-06-22T10:05:00Z",
  "message": "User login successful",
  "level": "INFO",
  "service": "amazon-prime-auth"
}
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="success-box">
                            <strong>Next:</strong> Go to "Discover" in OpenSearch Dashboards to see your sample data!
                        </div>
                    </div>
                </div>

                <div class="resource-monitor">
                    <h4>📊 Phase 4 Status</h4>
                    <div class="monitor-grid">
                        <div class="monitor-card">
                            <div class="monitor-value">✅</div>
                            <div class="monitor-label">NodePort Service</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-value">30001</div>
                            <div class="monitor-label">NodePort</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-value">✅</div>
                            <div class="monitor-label">Sample Data</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-value">Ready</div>
                            <div class="monitor-label">For Production</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Phase 5: Monitoring -->
            <div class="phase" id="phase5">
                <div class="phase-header">
                    <div class="phase-title">📈 Phase 5: Monitoring Setup</div>
                    <div class="phase-description">Deploy Prometheus and Grafana for comprehensive monitoring</div>
                </div>

                <div class="step">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-checkbox" onclick="toggleCheckbox(event, this)"></div>
                        <div class="step-title">Step 5.1: Deploy Prometheus</div>
                        <span class="expand-icon">▼</span>
                    </div>
                    <div class="step-content collapsible-content">
                        <p>Deploy Prometheus for metrics collection from your ELK stack.</p>
                        
                        <div class="command-block">
helm install prometheus prometheus-community/kube-prometheus-stack --namespace monitoring --set prometheus.prometheusSpec.storageSpec.volumeClaimTemplate.spec.resources.requests.storage=10Gi
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
kubectl get pods -n monitoring
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="warning-box">
                            <strong>Wait time:</strong> Prometheus stack can take 5-7 minutes to fully deploy. Be patient!
                        </div>
                        
                        <div class="command-block">
kubectl get services -n monitoring
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                    </div>
                </div>

                <div class="step">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-checkbox" onclick="toggleCheckbox(event, this)"></div>
                        <div class="step-title">Step 5.2: Access Grafana Dashboard</div>
                        <span class="expand-icon">▼</span>
                    </div>
                    <div class="step-content collapsible-content">
                        <p>Access Grafana to view your monitoring dashboards.</p>
                        
                        <div class="command-block">
kubectl port-forward -n monitoring svc/prometheus-grafana 3000:80
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="info-box">
                            <strong>Access URL:</strong> <a href="http://localhost:3000" target="_blank">http://localhost:3000</a>
                        </div>
                        
                        <div class="success-box">
                            <strong>Default Credentials:</strong><br>
                            Username: <strong>admin</strong><br>
                            Password: <strong>prom-operator</strong>
                        </div>
                        
                        <div class="command-block">
# Get the actual Grafana password
kubectl get secret --namespace monitoring prometheus-grafana -o jsonpath="{.data.admin-password}" | base64 --decode ; echo
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                    </div>
                </div>

                <div class="step">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-checkbox" onclick="toggleCheckbox(event, this)"></div>
                        <div class="step-title">Step 5.3: Access Prometheus UI</div>
                        <span class="expand-icon">▼</span>
                    </div>
                    <div class="step-content collapsible-content">
                        <p>Access Prometheus directly for metrics exploration.</p>
                        
                        <div class="command-block">
kubectl port-forward -n monitoring svc/prometheus-kube-prometheus-prometheus 9090:9090
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="info-box">
                            <strong>Access URL:</strong> <a href="http://localhost:9090" target="_blank">http://localhost:9090</a>
                        </div>
                        
                        <div class="success-box">
                            <strong>Try these queries in Prometheus:</strong><br>
                            • <code>up</code> - See which targets are up<br>
                            • <code>node_memory_MemAvailable_bytes</code> - Available memory<br>
                            • <code>rate(container_cpu_usage_seconds_total[5m])</code> - CPU usage
                        </div>
                    </div>
                </div>

                <div class="step">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-checkbox" onclick="toggleCheckbox(event, this)"></div>
                        <div class="step-title">Step 5.4: Configure OpenSearch Monitoring</div>
                        <span class="expand-icon">▼</span>
                    </div>
                    <div class="step-content collapsible-content">
                        <p>Add OpenSearch metrics to Prometheus monitoring.</p>
                        
                        <div class="command-block">
cat > opensearch-servicemonitor.yaml << 'EOF'
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: opensearch-monitoring
  namespace: elk-stack
  labels:
    app: opensearch
spec:
  selector:
    matchLabels:
      app: opensearch
  endpoints:
  - port: http
    interval: 30s
    path: /_prometheus/metrics
EOF
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
kubectl apply -f opensearch-servicemonitor.yaml
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="info-box">
                            <strong>Note:</strong> OpenSearch metrics will now be available in Prometheus
                        </div>
                        
                        <div class="command-block">
kubectl get servicemonitor -n elk-stack
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                    </div>
                </div>

                <div class="resource-monitor">
                    <h4>📊 Phase 5 Status</h4>
                    <div class="monitor-grid">
                        <div class="monitor-card">
                            <div class="monitor-value">✅</div>
                            <div class="monitor-label">Prometheus</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-value">✅</div>
                            <div class="monitor-label">Grafana</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-value">3000</div>
                            <div class="monitor-label">Grafana Port</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-value">9090</div>
                            <div class="monitor-label">Prometheus Port</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Phase 6: Jenkins Pipeline -->
            <div class="phase" id="phase6">
                <div class="phase-header">
                    <div class="phase-title">🔄 Phase 6: Jenkins CI/CD Pipeline</div>
                    <div class="phase-description">Automate your ELK stack deployment with Jenkins</div>
                </div>

                <div class="step">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-checkbox" onclick="toggleCheckbox(event, this)"></div>
                        <div class="step-title">Step 6.1: Prepare Jenkins Environment</div>
                        <span class="expand-icon">▼</span>
                    </div>
                    <div class="step-content collapsible-content">
                        <p>Configure Jenkins for Kubernetes deployments.</p>
                        
                        <div class="info-box">
                            <strong>Prerequisites:</strong> Your Jenkins server (t3.medium) should have kubectl and helm installed
                        </div>
                        
                        <div class="command-block">
# Install kubectl on Jenkins server
curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
# Install Helm on Jenkins server
curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
# Configure kubectl for EKS
aws eks update-kubeconfig --region us-east-1 --name amazon-prime-eks
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                    </div>
                </div>

                <div class="step">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-checkbox" onclick="toggleCheckbox(event, this)"></div>
                        <div class="step-title">Step 6.2: Create Jenkins Pipeline Script</div>
                        <span class="expand-icon">▼</span>
                    </div>
                    <div class="step-content collapsible-content">
                        <p>Create a comprehensive Jenkins pipeline for ELK stack deployment.</p>
                        
                        <div class="command-block">
cat > Jenkinsfile << 'EOF'
pipeline {
    agent any
    
    environment {
        AWS_DEFAULT_REGION = 'us-east-1'
        EKS_CLUSTER_NAME = 'amazon-prime-eks'
        NAMESPACE = 'elk-stack'
    }
    
    stages {
        stage('Checkout') {
            steps {
                checkout scm
            }
        }
        
        stage('Validate Environment') {
            steps {
                script {
                    sh '''
                        echo "Validating kubectl access..."
                        kubectl get nodes
                        
                        echo "Validating Helm..."
                        helm version
                        
                        echo "Checking namespaces..."
                        kubectl get namespace ${NAMESPACE} || kubectl create namespace ${NAMESPACE}
                    '''
                }
            }
        }
        
        stage('Update Helm Repositories') {
            steps {
                sh '''
                    helm repo add opensearch https://opensearch-project.github.io/helm-charts/
                    helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
                    helm repo update
                '''
            }
        }
        
        stage('Deploy OpenSearch') {
            steps {
                script {
                    sh '''
                        # Check if OpenSearch is already deployed
                        if helm list -n ${NAMESPACE} | grep -q "amazon-prime-opensearch"; then
                            echo "OpenSearch already deployed, upgrading..."
                            helm upgrade amazon-prime-opensearch opensearch/opensearch -f opensearch-values.yaml -n ${NAMESPACE}
                        else
                            echo "Deploying OpenSearch..."
                            helm install amazon-prime-opensearch opensearch/opensearch -f opensearch-values.yaml -n ${NAMESPACE}
                        fi
                        
                        # Wait for OpenSearch to be ready
                        kubectl wait --for=condition=ready pod -l app=opensearch -n ${NAMESPACE} --timeout=300s
                    '''
                }
            }
        }
        
        stage('Deploy OpenSearch Dashboards') {
            steps {
                script {
                    sh '''
                        # Check if Dashboards is already deployed
                        if helm list -n ${NAMESPACE} | grep -q "amazon-prime-dashboards"; then
                            echo "OpenSearch Dashboards already deployed, upgrading..."
                            helm upgrade amazon-prime-dashboards opensearch/opensearch-dashboards -f opensearch-dashboards-values.yaml -n ${NAMESPACE}
                        else
                            echo "Deploying OpenSearch Dashboards..."
                            helm install amazon-prime-dashboards opensearch/opensearch-dashboards -f opensearch-dashboards-values.yaml -n ${NAMESPACE}
                        fi
                        
                        # Wait for Dashboards to be ready
                        kubectl wait --for=condition=ready pod -l app=opensearch-dashboards -n ${NAMESPACE} --timeout=300s
                    '''
                }
            }
        }
        
        stage('Deploy Monitoring') {
            steps {
                script {
                    sh '''
                        # Deploy Prometheus if not exists
                        if ! helm list -n monitoring | grep -q "prometheus"; then
                            echo "Deploying Prometheus..."
                            kubectl create namespace monitoring || true
                            helm install prometheus prometheus-community/kube-prometheus-stack --namespace monitoring
                        else
                            echo "Prometheus already deployed"
                        fi
                    '''
                }
            }
        }
        
        stage('Validate Deployment') {
            steps {
                script {
                    sh '''
                        echo "=== Deployment Validation ==="
                        
                        echo "Checking OpenSearch health..."
                        kubectl get pods -n ${NAMESPACE} -l app=opensearch
                        
                        echo "Checking OpenSearch Dashboards..."
                        kubectl get pods -n ${NAMESPACE} -l app=opensearch-dashboards
                        
                        echo "Checking services..."
                        kubectl get services -n ${NAMESPACE}
                        
                        echo "Testing OpenSearch connectivity..."
                        kubectl exec -n ${NAMESPACE} -it $(kubectl get pods -n ${NAMESPACE} -l app=opensearch -o jsonpath='{.items[0].metadata.name}') -- curl -s http://localhost:9200/_cluster/health
                    '''
                }
            }
        }
        
        stage('Generate Access Instructions') {
            steps {
                script {
                    sh '''
                        echo "=== ACCESS INSTRUCTIONS ==="
                        echo "1. Port-forward to OpenSearch Dashboards:"
                        echo "   kubectl port-forward -n ${NAMESPACE} svc/amazon-prime-dashboards-opensearch-dashboards 5601:5601"
                        echo ""
                        echo "2. Access URL: http://localhost:5601"
                        echo ""
                        echo "3. Port-forward to Grafana:"
                        echo "   kubectl port-forward -n monitoring svc/prometheus-grafana 3000:80"
                        echo ""
                        echo "4. Grafana URL: http://localhost:3000"
                        echo "   Username: admin"
                        echo "   Password: prom-operator"
                    '''
                }
            }
        }
    }
    
    post {
        success {
            echo 'ELK Stack deployment completed successfully!'
        }
        failure {
            echo 'ELK Stack deployment failed. Check logs for details.'
        }
        always {
            // Clean up any temporary files
            sh 'echo "Pipeline completed"'
        }
    }
}
EOF
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                    </div>
                </div>

                <div class="step">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-checkbox" onclick="toggleCheckbox(event, this)"></div>
                        <div class="step-title">Step 6.3: Commit Files to GitHub Repository</div>
                        <span class="expand-icon">▼</span>
                    </div>
                    <div class="step-content collapsible-content">
                        <p>Add all configuration files to your GitHub repository.</p>
                        
                        <div class="command-block">
# Clone your repository
git clone https://github.com/la-belle-femme/250612-ci-cd-pipeline-amazone-prime-project.git
cd 250612-ci-cd-pipeline-amazone-prime-project
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
# Copy configuration files to repository
cp ../opensearch-values.yaml .
cp ../opensearch-dashboards-values.yaml .
cp ../Jenkinsfile .
cp ../opensearch-ingress.yaml .
cp ../nodeport-service.yaml .
cp ../opensearch-servicemonitor.yaml .
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
# Create a README for the deployment
cat > ELK-DEPLOYMENT-README.md << 'EOF'
# ELK Stack Deployment for Amazon Prime Project

## Overview
Production-grade OpenSearch and OpenSearch Dashboards deployment on AWS EKS.

## Architecture
- **OpenSearch**: Single-node cluster for log storage and search
- **OpenSearch Dashboards**: Web interface for data visualization
- **Prometheus**: Metrics collection and monitoring
- **Grafana**: Monitoring dashboards
- **Jenkins**: CI/CD automation

## Quick Start
1. Ensure EKS cluster is running: `amazon-prime-eks`
2. Run Jenkins pipeline or manual deployment
3. Access via port-forwarding: `kubectl port-forward -n elk-stack svc/amazon-prime-dashboards-opensearch-dashboards 5601:5601`

## Manual Deployment
```bash
# Deploy OpenSearch
helm install amazon-prime-opensearch opensearch/opensearch -f opensearch-values.yaml -n elk-stack

# Deploy OpenSearch Dashboards
helm install amazon-prime-dashboards opensearch/opensearch-dashboards -f opensearch-dashboards-values.yaml -n elk-stack
```

## Access URLs
- OpenSearch Dashboards: http://localhost:5601 (via port-forward)
- Grafana: http://localhost:3000 (via port-forward)
- Prometheus: http://localhost:9090 (via port-forward)

## Team Capacity
- Designed for 10 concurrent users
- Scalable architecture for future growth

## Monitoring
- Full Prometheus stack included
- Pre-configured Grafana dashboards
- OpenSearch health monitoring
EOF
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="command-block">
# Commit and push to GitHub
git add .
git commit -m "Add ELK Stack deployment configuration and Jenkins pipeline"
git push origin main
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                    </div>
                </div>

                <div class="step">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-checkbox" onclick="toggleCheckbox(event, this)"></div>
                        <div class="step-title">Step 6.4: Create Jenkins Pipeline Job</div>
                        <span class="expand-icon">▼</span>
                    </div>
                    <div class="step-content collapsible-content">
                        <p>Create a new Jenkins pipeline job for automated deployment.</p>
                        
                        <div class="info-box">
                            <strong>Jenkins UI Steps:</strong>
                        </div>
                        
                        <ol>
                            <li><strong>Access Jenkins:</strong> http://your-jenkins-server:8080</li>
                            <li><strong>New Item:</strong> Click "New Item"</li>
                            <li><strong>Name:</strong> "ELK-Stack-Deployment"</li>
                            <li><strong>Type:</strong> Select "Pipeline"</li>
                            <li><strong>Click OK</strong></li>
                        </ol>
                        
                        <div class="success-box">
                            <strong>Pipeline Configuration:</strong><br>
                            • <strong>Definition:</strong> Pipeline script from SCM<br>
                            • <strong>SCM:</strong> Git<br>
                            • <strong>Repository URL:</strong> https://github.com/la-belle-femme/250612-ci-cd-pipeline-amazone-prime-project.git<br>
                            • <strong>Branch:</strong> */main<br>
                            • <strong>Script Path:</strong> Jenkinsfile
                        </div>
                        
                        <div class="warning-box">
                            <strong>Important:</strong> Ensure Jenkins has AWS credentials configured and kubectl access to your EKS cluster
                        </div>
                    </div>
                </div>

                <div class="step">
                    <div class="step-header" onclick="toggleStep(this)">
                        <div class="step-checkbox" onclick="toggleCheckbox(event, this)"></div>
                        <div class="step-title">Step 6.5: Run Jenkins Pipeline</div>
                        <span class="expand-icon">▼</span>
                    </div>
                    <div class="step-content collapsible-content">
                        <p>Execute your automated ELK stack deployment.</p>
                        
                        <div class="command-block">
# Trigger the pipeline
curl -X POST http://your-jenkins-server:8080/job/ELK-Stack-Deployment/build --user admin:your-jenkins-token
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                        
                        <div class="info-box">
                            <strong>Alternative:</strong> Click "Build Now" in the Jenkins UI
                        </div>
                        
                        <div class="success-box">
                            <strong>Expected Pipeline Stages:</strong><br>
                            ✅ Checkout<br>
                            ✅ Validate Environment<br>
                            ✅ Update Helm Repositories<br>
                            ✅ Deploy OpenSearch<br>
                            ✅ Deploy OpenSearch Dashboards<br>
                            ✅ Deploy Monitoring<br>
                            ✅ Validate Deployment<br>
                            ✅ Generate Access Instructions
                        </div>
                        
                        <div class="command-block">
# Monitor the build
tail -f /var/log/jenkins/jenkins.log
                            <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                        </div>
                    </div>
                </div>

                <div class="resource-monitor">
                    <h4>📊 Phase 6 Status</h4>
                    <div class="monitor-grid">
                        <div class="monitor-card">
                            <div class="monitor-value">✅</div>
                            <div class="monitor-label">Jenkins Pipeline</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-value">✅</div>
                            <div class="monitor-label">GitHub Integration</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-value">8</div>
                            <div class="monitor-label">Pipeline Stages</div>
                        </div>
                        <div class="monitor-card">
                            <div class="monitor-value">Automated</div>
                            <div class="monitor-label">Deployment</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Final Summary -->
            <div class="phase" id="summary">
                <div class="phase-header">
                    <div class="phase-title">🎉 Deployment Complete!</div>
                    <div class="phase-description">Your production-grade ELK stack is ready</div>
                </div>

                <div class="architecture-overview">
                    <h3>🎯 Final Architecture</h3>
                    <div class="mermaid-container">
                        <div class="mermaid">
                            graph TB
                                subgraph "Production ELK Stack"
                                    subgraph "elk-stack namespace"
                                        OS[OpenSearch<br/>✅ Running]
                                        OSD[OpenSearch Dashboards<br/>✅ Accessible]
                                        OS --> OSD
                                    end
                                    
                                    subgraph "monitoring namespace"
                                        PROM[Prometheus<br/>✅ Collecting Metrics]
                                        GRAF[Grafana<br/>✅ Dashboards Ready]
                                        PROM --> GRAF
                                    end
                                    
                                    subgraph "Access Points"
                                        PF1[Port-Forward 5601<br/>OpenSearch Dashboards]
                                        PF2[Port-Forward 3000<br/>Grafana]
                                        PF3[Port-Forward 9090<br/>Prometheus]
                                    end
                                    
                                    subgraph "CI/CD"
                                        JENKINS[Jenkins Pipeline<br/>✅ Automated]
                                        GIT[GitHub Repo<br/>✅ Updated]
                                        GIT --> JENKINS
                                        JENKINS --> OS
                                    end
                                end
                                
                                USER[👥 10 Users] --> PF1
                                USER --> PF2
                                ADMIN[👤 Admin] --> PF3
                                
                                style OS fill:#e8f5e8
                                style OSD fill:#e8f5e8
                                style PROM fill:#e8f5e8
                                style GRAF fill:#e8f5e8
                                style JENKINS fill:#e8f5e8
                        </div>
                    </div>
                </div>

                <div class="requirements-grid">
                    <div class="requirement-card">
                        <div class="requirement-title">🌟 Successfully Deployed</div>
                        <ul>
                            <li>✅ OpenSearch cluster (single-node)</li>
                            <li>✅ OpenSearch Dashboards (no authentication)</li>
                            <li>✅ Prometheus monitoring</li>
                            <li>✅ Grafana dashboards</li>
                            <li>✅ Jenkins automation pipeline</li>
                        </ul>
                    </div>
                    
                    <div class="requirement-card">
                        <div class="requirement-title">🔗 Access Methods</div>
                        <ul>
                            <li><strong>OpenSearch Dashboards:</strong><br><code>kubectl port-forward -n elk-stack svc/amazon-prime-dashboards-opensearch-dashboards 5601:5601</code><br>URL: <a href="http://localhost:5601" target="_blank">http://localhost:5601</a></li>
                            <li><strong>Grafana:</strong><br><code>kubectl port-forward -n monitoring svc/prometheus-grafana 3000:80</code><br>URL: <a href="http://localhost:3000" target="_blank">http://localhost:3000</a></li>
                        </ul>
                    </div>
                    
                    <div class="requirement-card">
                        <div class="requirement-title">📊 Monitoring Ready</div>
                        <ul>
                            <li>✅ Prometheus collecting metrics</li>
                            <li>✅ Grafana dashboards configured</li>
                            <li>✅ OpenSearch health monitoring</li>
                            <li>✅ Kubernetes cluster monitoring</li>
                            <li>✅ Application performance tracking</li>
                        </ul>
                    </div>
                    
                    <div class="requirement-card">
                        <div class="requirement-title">🔄 CI/CD Pipeline</div>
                        <ul>
                            <li>✅ GitHub repository updated</li>
                            <li>✅ Jenkins pipeline created</li>
                            <li>✅ Automated deployment script</li>
                            <li>✅ Configuration management</li>
                            <li>✅ Rollback capabilities</li>
                        </ul>
                    </div>
                </div>

                <div class="success-box">
                    <strong>🎉 Congratulations!</strong> Your production-grade ELK stack is now running on AWS EKS. 
                    You've successfully avoided all the common pitfalls and have a robust, scalable logging solution 
                    for your team of 10 users. The Jenkins pipeline ensures consistent deployments and easy updates.
                </div>

                <div class="info-box">
                    <strong>Next Steps:</strong><br>
                    • Configure log shipping from your applications<br>
                    • Set up alerting rules in Prometheus<br>
                    • Create custom Grafana dashboards<br>
                    • Configure data retention policies<br>
                    • Set up backup strategies
                </div>

                <div class="warning-box">
                    <strong>Production Considerations:</strong><br>
                    • Consider enabling authentication for external access<br>
                    • Implement proper backup strategies<br>
                    • Monitor resource usage and scale as needed<br>
                    • Regular security updates and patches
                </div>
            </div>
        </div>

        <div class="navigation-buttons">
            <button class="nav-button" id="prevBtn" onclick="previousPhase()" disabled>← Previous</button>
            <button class="nav-button" id="nextBtn" onclick="nextPhase()">Next →</button>
        </div>
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true
            }
        });

        let currentPhase = 0;
        const phases = ['overview', 'phase1', 'phase2', 'phase3', 'phase4', 'phase5', 'phase6', 'summary'];
        
        function showPhase(phaseIndex) {
            // Hide all phases
            document.querySelectorAll('.phase').forEach(phase => {
                phase.classList.remove('active');
            });
            
            // Show current phase
            document.getElementById(phases[phaseIndex]).classList.add('active');
            
            // Update navigation tabs
            document.querySelectorAll('.nav-tab').forEach((tab, index) => {
                tab.classList.remove('active', 'completed');
                if (index === phaseIndex) {
                    tab.classList.add('active');
                } else if (index < phaseIndex) {
                    tab.classList.add('completed');
                }
            });
            
            // Update navigation buttons
            document.getElementById('prevBtn').disabled = phaseIndex === 0;
            document.getElementById('nextBtn').disabled = phaseIndex === phases.length - 1;
            
            // Update progress bar
            const progress = (phaseIndex / (phases.length - 1)) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            
            // Update button text
            if (phaseIndex === phases.length - 1) {
                document.getElementById('nextBtn').textContent = 'Complete! 🎉';
                document.getElementById('nextBtn').disabled = true;
            } else {
                document.getElementById('nextBtn').textContent = 'Next →';
            }
        }
        
        function nextPhase() {
            if (currentPhase < phases.length - 1) {
                currentPhase++;
                showPhase(currentPhase);
            }
        }
        
        function previousPhase() {
            if (currentPhase > 0) {
                currentPhase--;
                showPhase(currentPhase);
            }
        }
        
        // Handle tab clicks
        document.querySelectorAll('.nav-tab').forEach((tab, index) => {
            tab.addEventListener('click', () => {
                currentPhase = index;
                showPhase(currentPhase);
            });
        });
        
        // Toggle step expansion
        function toggleStep(header) {
            const content = header.nextElementSibling;
            const icon = header.querySelector('.expand-icon');
            
            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                icon.classList.remove('rotated');
            } else {
                content.classList.add('expanded');
                icon.classList.add('rotated');
            }
        }
        
        // Toggle checkbox
        function toggleCheckbox(event, checkbox) {
            event.stopPropagation();
            checkbox.classList.toggle('completed');
            
            // Update progress based on completed checkboxes
            updateProgress();
        }
        
        function updateProgress() {
            const allCheckboxes = document.querySelectorAll('.step-checkbox');
            const completedCheckboxes = document.querySelectorAll('.step-checkbox.completed');
            const progress = (completedCheckboxes.length / allCheckboxes.length) * 100;
            
            // Could add a secondary progress bar for individual steps
        }
        
        // Copy to clipboard functionality
        function copyToClipboard(button) {
            const codeBlock = button.parentElement;
            const code = codeBlock.textContent.replace(button.textContent, '').replace('$ ', '').trim();
            
            navigator.clipboard.writeText(code).then(() => {
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                button.classList.add('copied');
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = code;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                button.textContent = 'Copied!';
                setTimeout(() => {
                    button.textContent = 'Copy';
                }, 2000);
            });
        }
        
        // Auto-expand first step of each phase
        document.addEventListener('DOMContentLoaded', function() {
            // Expand first step in overview
            const firstSteps = document.querySelectorAll('.phase .step:first-of-type .step-header');
            firstSteps.forEach(header => {
                const content = header.nextElementSibling;
                const icon = header.querySelector('.expand-icon');
                content.classList.add('expanded');
                icon.classList.add('rotated');
            });
        });
        
        // Keyboard navigation
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey || event.metaKey) {
                switch(event.key) {
                    case 'ArrowLeft':
                        event.preventDefault();
                        previousPhase();
                        break;
                    case 'ArrowRight':
                        event.preventDefault();
                        nextPhase();
                        break;
                }
            }
        });
    </script>
</body>
</html>